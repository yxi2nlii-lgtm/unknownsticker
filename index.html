<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pink Sticker ‚Äî 90 Degrees</title>

    <style>
        :root {
            --line-thickness: 10px;
            --max-move-distance: 30px; 
            --max-squeeze-scale: 0.90; 
            --max-stretch-scale: 1.05;
            --face-shift-ratio: 0.15; 
            --face-padding: 40px; 
        }

        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: #FFE4EC;   /* Á≤âËâ≤ËÉåÊôØ */
            font-family: sans-serif;
        }

        .text-area {
            width: 100%;
            text-align: center;
            margin-bottom: 18px;
            min-height: 90px;
        }

        .story-line {
            opacity: 0;
            margin: 4px 0;
            font-size: 15px;
            transition: opacity 0.6s ease;
        }
        .story-line.visible {
            opacity: 1;
        }

        .emoji-container {
            width: 65vw;
            max-width: 240px;
            aspect-ratio: 1/1;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .big-circle {
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background: #FFB7CE;
            box-shadow: 0 8px 18px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.25s ease;
        }

        .features-wrapper {
            position: absolute;
            inset: 0;
            transition: transform 0.1s ease-out;
        }

        /* ÈóÆÂè∑ */
        #questionFace { display: block; }
        #smileFace { display: none; }

        .question-arc {
            position: absolute;
            width: 90px;
            height: 90px;
            border: var(--line-thickness) solid #000;
            border-bottom-color: transparent;
            border-radius: 50%;
            top: 22%;
            left: 50%;
            transform: translateX(-50%) rotate(40deg);
        }
        .question-stem {
            position: absolute;
            width: var(--line-thickness);
            height: 30px;
            background: #000;
            top: 58%;
            left: 50%;
            transform: translateX(-50%);
        }
        .question-dot {
            position: absolute;
            width: var(--line-thickness);
            height: var(--line-thickness);
            background: #000;
            top: 73%;
            left: 50%;
            transform: translateX(-50%);
        }

        /* Á¨ëËÑ∏ */
        .eye, .mouth {
            position: absolute;
            background: #000;
        }
        .eye {
            width: var(--line-thickness);
            height: 30px;
            top: 34%;
        }
        .left-eye { left: 35%; transform: translateX(-50%); }
        .right-eye { right: 35%; transform: translateX(50%); }

        .mouth {
            width: 80px;
            height: 80px;
            border: var(--line-thickness) solid black;
            border-color: transparent transparent black transparent;
            border-radius: 50%;
            bottom: 27%;
            right: 30%;
            transform: rotate(-45deg);
            background: transparent;
        }

        #blynk-status {
            margin-top: 16px;
            font-size: 13px;
            opacity: 0.7;
        }
    </style>
</head>

<body>

    <!-- È°∂ÈÉ®ÊñáÂ≠ó -->
    <div class="text-area">
        <p id="line1" class="story-line"></p>
        <p id="line2" class="story-line"></p>
        <p id="line3" class="story-line"></p>
    </div>

    <!-- ÂúÜÂΩ¢‰∫§‰∫íÂå∫ -->
    <div class="emoji-container" id="emojiContainer">
        <div class="big-circle" id="bigCircle">
            <div class="features-wrapper" id="featuresWrapper">
                <div id="questionFace">
                    <div class="question-arc"></div>
                    <div class="question-stem"></div>
                    <div class="question-dot"></div>
                </div>
                <div id="smileFace">
                    <div class="eye left-eye"></div>
                    <div class="eye right-eye"></div>
                    <div class="mouth"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="blynk-status">Blynk Status: Idle</div>

<script>
/* =================== ÊñáÊ°à =================== */

const lines = [
    ["Hi there!", "Thanks for stopping by üíó", ""],
    ["This little pink circle", "is my way of saying hello.", ""],
    ["Thanks!", "Hope you have a warm day üíó", ""]
];

let page = 0;
const line1 = document.getElementById("line1");
const line2 = document.getElementById("line2");
const line3 = document.getElementById("line3");

function showPage(i) {
    [line1, line2, line3].forEach(el => el.classList.remove("visible"));

    setTimeout(() => {
        line1.textContent = lines[i][0];
        line2.textContent = lines[i][1];
        line3.textContent = lines[i][2];

        setTimeout(() => {
            if (lines[i][0]) line1.classList.add("visible");
            if (lines[i][1]) line2.classList.add("visible");
            if (lines[i][2]) line3.classList.add("visible");
        }, 30);
    }, 20);
}

/* =================== ‰∫íÂä®Âä®Áîª =================== */

const container = document.getElementById("emojiContainer");
const wrapper = document.getElementById("featuresWrapper");
const questionFace = document.getElementById("questionFace");
const smileFace = document.getElementById("smileFace");

const maxDistance = 30;
const faceShift = 0.15;

function handleMove(e) {
    const x = e.clientX || (e.touches && e.touches[0].clientX);
    const y = e.clientY || (e.touches && e.touches[0].clientY);

    if (!x || !y) return;

    const rect = container.getBoundingClientRect();
    const cx = rect.left + rect.width / 2;
    const cy = rect.top + rect.height / 2;

    let dx = x - cx;
    let dy = y - cy;
    let dist = Math.sqrt(dx*dx + dy*dy);

    if (dist > maxDistance) {
        const r = maxDistance / dist;
        dx *= r; dy *= r;
    }

    container.style.transform = `translate(${dx * -faceShift}px, ${dy * -faceShift}px)`;
    wrapper.style.transform = `translate(${dx}px, ${dy}px)`;
}

function resetPos() {
    container.style.transform = "translate(0,0)";
    wrapper.style.transform = "translate(0,0)";
}

document.addEventListener("mousemove", handleMove);
document.addEventListener("touchmove", handleMove);
document.addEventListener("mouseup", resetPos);
document.addEventListener("touchend", resetPos);

/* =================== Blynk ÊéßÂà∂ =================== */

const AUTH_TOKEN = "OqSFS2EppKQRi0DYBOTFNEQgW7pljRjT";
const HOST = "blynk.cloud";
const PIN = "V1";

/* üíó Pink Âèë 90¬∞ */
const PICKUP_ANGLE = 90;
const RESET_ANGLE = 0;

async function sendCommand(value) {
    const status = document.getElementById("blynk-status");

    const urlPush = `https://${HOST}/external/api/update?token=${AUTH_TOKEN}&${PIN}=${value}`;
    const urlReset = `https://${HOST}/external/api/update?token=${AUTH_TOKEN}&${PIN}=${RESET_ANGLE}`;

    status.textContent = `Sending ${value}¬∞ ...`;

    try {
        await fetch(urlPush);
        status.textContent = `Sent ${value}¬∞, resetting...`;
        await fetch(urlReset);
        status.textContent = `Done ‚úî`;
    } catch {
        status.textContent = `Error sending command`;
    }
}

/* =================== ÁÇπÂáª‰∫ã‰ª∂ =================== */

container.addEventListener("click", async () => {
    page++;
    if (page > 2) page = 0;

    showPage(page);

    if (page === 2) {
        questionFace.style.display = "none";
        smileFace.style.display = "block";

        await sendCommand(PICKUP_ANGLE);
    }
});

showPage(0);

</script>
</body>
</html>
